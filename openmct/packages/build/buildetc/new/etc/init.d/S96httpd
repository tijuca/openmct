#!/bin/sh
. /var/etc/rc.conf
CONFIG=/var/etc/httpd.conf
PID=`pidof httpd`

check_config(){
  if [ ! -r $CONFIG ]; then
  echo -e "\033[1;33mCreating default $CONFIG for httpd!\033[0m"
  cat > $CONFIG << __EOF__
# httpd.conf has the following format:
#
# A:172.20.         # Allow address from 172.20.0.0/16
# A:10.0.0.0/25     # Allow any address from 10.0.0.0-10.0.0.127
# A:10.0.0.0/255.255.255.128  # Allow any address that previous set
# A:127.0.0.1       # Allow local loopback connections
# D:*               # Deny from other IP connections
# /cgi-bin:foo:bar  # Require user foo, pwd bar on urls starting with /cgi-bin/
# /adm:admin:setup  # Require user admin, pwd setup on urls starting with /adm/
# /adm:toor:PaSsWd  # or user toor, pwd PaSsWd on urls starting with /adm/
# .au:audio/basic   # additional mime type for audio.au files
#
A:*
/cgi-bin:root:168Mct168
__EOF__
  fi
}

case "$1" in
        start)
            if [ "$START_HTTPD" == "yes" ]; then
		check_config
		/bin/echo -n "Starting httpd ... "
		if [ "$PID" != "" ]; then
		    /bin/echo -e "\033[1;33mhttpd is already running! Try 'stop' or 'restart'!\033[0m"
		    exit
		fi
		if [ -d /usr/var/www ]; then
    	    		/sbin/httpd -h /usr/var/www -c $CONFIG
	    		/bin/echo "with document root from hardisk (/usr/var/www) ... "
		else
    	    		/sbin/httpd -h /var/www -c $CONFIG
	    		/bin/echo -n "with document root from flash (/var/www/) ... "
		fi
		/bin/echo -e "\033[1;32mdone\033[0m"
   	    elif [ "$START_???" != "yes" ]; then
   	        /bin/echo -e "\033[1;33mYour /var/etc/rc.conf is not configured for starting 'httpd' automaticly!\033[0m"
	    fi
            ;;

        stop)
            /bin/echo -n "Stopping httpd ... "
	    if [ "$PID" == "" ]; then
		/bin/echo -e "\033[1;33mhttpd is already stopped!\033[0m"
		exit
	    fi
            killall -9 httpd
	    /bin/echo -e "\033[1;32mdone\033[0m"
            ;;

        restart)
            $0 stop
            sleep 1
            $0 start
            ;;

        *)
            echo "Usage: $0 {start|stop|restart}"
            exit 1
    	    ;;
esac
